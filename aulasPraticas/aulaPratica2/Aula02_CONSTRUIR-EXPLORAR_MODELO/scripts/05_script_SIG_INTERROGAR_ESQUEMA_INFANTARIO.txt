--#############
--# GRUPO 04
--#############




--=============
-- Liga��o � BD
--=============
\set dataBase my_gis
;
\set userName postgres
;
\connect :dataBase :userName
;
--==========================
--==========================


-- mais informa��o sobre "client_encoding" em:
-- http://www.postgresql.org/docs/9.4/static/multibyte.html
\encoding WIN1250
;




--===================
-- Interrogar CLIENTE
--===================

-- Ponto geografico de cada cliente

SELECT ST_AsText(local) AS point FROM cliente;

-- cada uma das coordenadas (ordenadas e abcissa) do ponto geogr�fico de cada cliente

SELECT ST_X(local) AS x, ST_Y(local) AS y FROM cliente ORDER BY x,y;


--=====================
-- Interrogar FREGUESIA
--=====================

-- Espa�o geografico delimitado por cada freguesia

SELECT ST_Extent(local) AS espaco FROM freguesia;



-- �rea ocupada por cada freguesia

SELECT ST_Area(local) AS area FROM freguesia;





--==================================
-- Interrogar INFANTARIO e FREGUESIA
--==================================

-- Infant�rios (nome e geometria) de cada freguesia (nome e geometria)
-- considerando apenas opera��es espaciais

SELECT
    freguesia.nome AS nome_freguesia,
    ST_AsText(freguesia.local) AS local_freguesia,
    infantario.nome as nome_infantario,
    ST_AsText(infantario.local) AS local_infantario
FROM
    freguesia
JOIN
    infantario
ON 
    ST_Intersects(freguesia.local, infantario.local)   
;



SELECT
    freguesia.nome AS nome_freguesia,
    ST_AsText(freguesia.local) AS local_freguesia,
    infantario.nome as nome_infantario,
    ST_AsText(infantario.local) AS local_infantario
FROM
    freguesia
JOIN
    infantario
ON 
    ST_Within(freguesia.local, infantario.local);  -- don't showing because it is not completely within geometry


-- Dist�ncia de cada cliente a cada infant�rio indicando o seu nome pr�prio e de fam�lia

SELECT
    nomeproprio AS nome_proprio,
    apelido AS familia,
    infantario.nome AS nome_infantario,
    ST_Distance(cliente.local, infantario.local) AS distancia
FROM
    cliente,
    infantario;


-- nome do infant�rio e num �nico campo o nome pr�prio e de fam�lia dos clientes
-- que vivem a uma dist�ncia superior a 20 (unidades) de algum infant�rio

SELECT
    infantario.nome AS nome_infantario,
    TEXTCAT(TEXTCAT(cliente.nomeproprio, ' '), cliente.apelido) AS nome
FROM
    infantario
JOIN
    cliente
ON
    ST_Distance(infantario.local, cliente.local) > 20;
